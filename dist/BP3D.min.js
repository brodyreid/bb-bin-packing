!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("BinPacking",[],e):"object"==typeof exports?exports.BinPacking=e():t.BinPacking=e()}(this,(function(){return function(){"use strict";var t={d:function(e,i){for(var h in i)t.o(i,h)&&!t.o(e,h)&&Object.defineProperty(e,h,{enumerable:!0,get:i[h]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r:function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Bin:function(){return s},Item:function(){return g},Packer:function(){return u}});const i=t=>Math.round(t*10**5);function h(t,...e){}const n=function(t="binpackingjs"){return h.bind(void 0,t)}("3D:");class s{name="";width=0;height=0;depth=0;maxWeight=0;items=[];constructor(t,e,h,n,s){this.name=t,this.width=i(e),this.height=i(h),this.depth=i(n),this.maxWeight=i(s)}getName(){return this.name}getWidth(){return this.width}getHeight(){return this.height}getDepth(){return this.depth}getMaxWeight(){return this.maxWeight}getItems(){return this.items}getVolume(){return this.getWidth()*this.getHeight()*this.getDepth()}getPackedWeight(){return this.items.reduce(((t,e)=>t+e.getWeight()),0)}weighItem(t){const e=this.getMaxWeight();return!e||t.getWeight()+this.getPackedWeight()<=e}scoreRotation(t,e){t.rotationType=e;let i=t.getDimension();return this.getWidth()<i[0]||this.getHeight()<i[1]||this.getDepth()<i[2]?0:Math.pow(i[0]/this.getWidth(),2)+Math.pow(i[1]/this.getHeight(),2)+Math.pow(i[2]/this.getDepth(),2)}getBestRotationOrder(t){const e={};for(let i=0;i<t.allowedRotation.length;i++){const h=t.allowedRotation[i];e[h]=this.scoreRotation(t,h)}return Object.keys(e).sort(((t,i)=>e[i]-e[t])).map(Number)}putItem(t,e){const i=this;let h=!1;const s=this.getBestRotationOrder(t);t.position=e;for(let o=0;o<s.length;o++){t.rotationType=s[o];let r=t.getDimension();if(i.getWidth()<e[0]+r[0]||i.getHeight()<e[1]+r[1]||i.getDepth()<e[2]+r[2])h=!1;else{h=!0;for(let e=0;e<i.items.length;e++)if(i.items[e].intersect(t)){h=!1;break}h&&i.items.push(t)}if(n("try to putItem",h,"item",t.toString(),"box",i.toString()),h)break}return h}toString(){return`Bin:${this.name} (WxHxD = ${this.getWidth()}x${this.getHeight()}x${this.getDepth()}, MaxWg. = ${this.getMaxWeight()})`}}const o=[0,0,0],r={0:"RotationType_WHD (w,h,d)",1:"RotationType_HWD (h,w,d)",2:"RotationType_HDW (h,d,w)",3:"RotationType_DHW (d,h,w)",4:"RotationType_DWH (d,w,h)",5:"RotationType_WDH (w,d,h)"};class g{name="";width=0;height=0;depth=0;weight=0;allowedRotation=[0,1,2,3,4,5];rotationType=0;position=[];constructor(t,e,h,n,s,o){this.name=t,this.width=i(e),this.height=i(h),this.depth=i(n),this.weight=i(s),this.allowedRotation=o||this.allowedRotation}getWidth(){return this.width}getHeight(){return this.height}getDepth(){return this.depth}getWeight(){return this.weight}getRotationType(){return this.rotationType}getAllowedRotation(){return this.allowedRotation}getRotationTypeString(){return r[this.getRotationType()]}getDimension(){let t;switch(this.rotationType){case 0:t=[this.getWidth(),this.getHeight(),this.getDepth()];break;case 1:t=[this.getHeight(),this.getWidth(),this.getDepth()];break;case 2:t=[this.getHeight(),this.getDepth(),this.getWidth()];break;case 3:t=[this.getDepth(),this.getHeight(),this.getWidth()];break;case 4:t=[this.getDepth(),this.getWidth(),this.getHeight()];break;case 5:t=[this.getWidth(),this.getDepth(),this.getHeight()]}return t}intersect(t){return a(this,t,0,1)&&a(this,t,1,2)&&a(this,t,0,2)}getVolume(){return this.getWidth()*this.getHeight()*this.getDepth()}toString(){return`Item:${this.name} (${this.getRotationTypeString()} = ${this.getDimension().join("x")}, Wg. = ${this.weight})`}}const a=(t,e,i,h)=>{let n,s,o,r,g,a,u,p;return n=t.getDimension(),s=e.getDimension(),o=t.position[i]+n[i]/2,r=t.position[h]+n[h]/2,g=e.position[i]+s[i]/2,a=e.position[h]+s[h]/2,u=Math.max(o,g)-Math.min(o,g),p=Math.max(r,a)-Math.min(r,a),u<(n[i]+s[i])/2&&p<(n[h]+s[h])/2};class u{bins=[];items=[];unfitItems=[];addBin(t){this.bins.push(t)}addItem(t){this.items.push(t)}findFittedBin(t){for(let e=0;e<this.bins.length;e++){let i=this.bins[e];if(i.weighItem(t)&&i.putItem(t,o))return 1===i.items.length&&i.items[0]===t&&(i.items=[]),i}return null}getBiggerBinThan(t){let e=t.getVolume();for(let t=0;t<this.bins;t++){let i=this.bins[t];if(i.getVolume()>e)return i}return null}unfitItem(){0!==this.items.length&&(this.unfitItems.push(this.items[0]),this.items.splice(0,1))}packToBin(t,e){let i=null,h=[];if(!t.weighItem(e[0])||!t.putItem(e[0],o)){let i=this.getBiggerBinThan(t);return i?this.packToBin(i,e):this.items}for(let e=1;e<this.items.length;e++){let n=!1,s=this.items[e];if(t.weighItem(s))t:for(let e=0;e<3;e++)for(let i=0;i<t.items.length;i++){let h,o=t.items[i],r=o.getDimension();switch(e){case 0:h=[o.position[0]+r[0],o.position[1],o.position[2]];break;case 1:h=[o.position[0],o.position[1]+r[1],o.position[2]];break;case 2:h=[o.position[0],o.position[1],o.position[2]+r[2]]}if(t.putItem(s,h)){n=!0;break t}}if(!n){for(;null!==i;)if(i=this.getBiggerBinThan(t),i&&(i.items.push(s),0===this.packToBin(i,i.items).length)){t=i,n=!0;break}n||h.push(s)}}return h}pack(){for(this.bins.sort(((t,e)=>t.getVolume()-e.getVolume())),this.items.sort(((t,e)=>e.getVolume()-t.getVolume()));this.items.length>0;){let t=this.findFittedBin(this.items[0]);null!==t?this.items=this.packToBin(t,this.items):this.unfitItem()}return null}}return e}()}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9CaW5QYWNraW5nL3dlYnBhY2svdW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbiIsIndlYnBhY2s6Ly9CaW5QYWNraW5nL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL0JpblBhY2tpbmcvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL0JpblBhY2tpbmcvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9CaW5QYWNraW5nL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vQmluUGFja2luZy8uLzNEL3V0aWwuanMiLCJ3ZWJwYWNrOi8vQmluUGFja2luZy8uL2xpYi9sb2cuanMiLCJ3ZWJwYWNrOi8vQmluUGFja2luZy8uLzNEL0Jpbi5qcyIsIndlYnBhY2s6Ly9CaW5QYWNraW5nLy4vM0QvSXRlbS5qcyIsIndlYnBhY2s6Ly9CaW5QYWNraW5nLy4vM0QvUGFja2VyLmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsInRoaXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiZGVmaW5pdGlvbiIsImtleSIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsImZhY3RvcmVkSW50ZWdlciIsIk1hdGgiLCJyb3VuZCIsImxvZyIsIm5hbWVzcGFjZSIsImFyZ3MiLCJiaW5kIiwidW5kZWZpbmVkIiwiY3JlYXRlTG9nZ2VyIiwiQmluIiwibmFtZSIsInciLCJoIiwiZCIsIm13Iiwid2lkdGgiLCJoZWlnaHQiLCJkZXB0aCIsIm1heFdlaWdodCIsIml0ZW1zIiwiZ2V0V2lkdGgiLCJnZXRIZWlnaHQiLCJnZXREZXB0aCIsInJlZHVjZSIsIndlaWdodCIsIml0ZW0iLCJnZXRXZWlnaHQiLCJnZXRNYXhXZWlnaHQiLCJnZXRQYWNrZWRXZWlnaHQiLCJyb3RhdGlvblR5cGUiLCJnZXREaW1lbnNpb24iLCJwb3ciLCJyb3RhdGlvblNjb3JlcyIsImkiLCJhbGxvd2VkUm90YXRpb24iLCJsZW5ndGgiLCJyIiwic2NvcmVSb3RhdGlvbiIsImtleXMiLCJzb3J0IiwiYSIsImIiLCJtYXAiLCJOdW1iZXIiLCJwIiwiYm94IiwiZml0Iiwicm90YXRpb25zIiwiZ2V0QmVzdFJvdGF0aW9uT3JkZXIiLCJwb3NpdGlvbiIsImoiLCJpbnRlcnNlY3QiLCJwdXNoIiwidG9TdHJpbmciLCJTdGFydFBvc2l0aW9uIiwiUm90YXRpb25UeXBlU3RyaW5ncyIsIkl0ZW0iLCJ3ZyIsImdldFJvdGF0aW9uVHlwZSIsImkyIiwicmVjdEludGVyc2VjdCIsImdldFJvdGF0aW9uVHlwZVN0cmluZyIsImpvaW4iLCJpMSIsIngiLCJ5IiwiZDEiLCJkMiIsImN4MSIsImN5MSIsImN4MiIsImN5MiIsIml4IiwiaXkiLCJtYXgiLCJtaW4iLCJQYWNrZXIiLCJiaW4iLCJiaW5zIiwiX2kiLCJ3ZWlnaEl0ZW0iLCJwdXRJdGVtIiwidiIsImdldFZvbHVtZSIsImIyIiwidW5maXRJdGVtcyIsInNwbGljZSIsInVucGFja2VkIiwiZ2V0QmlnZ2VyQmluVGhhbiIsInBhY2tUb0JpbiIsImZpdHRlZCIsImxvb2t1cCIsIl9wdCIsIl9qIiwicHYiLCJpYiIsImZpbmRGaXR0ZWRCaW4iLCJ1bmZpdEl0ZW0iXSwibWFwcGluZ3MiOiJDQUFBLFNBQTJDQSxFQUFNQyxHQUMxQixpQkFBWkMsU0FBMEMsaUJBQVhDLE9BQ3hDQSxPQUFPRCxRQUFVRCxJQUNRLG1CQUFYRyxRQUF5QkEsT0FBT0MsSUFDOUNELE9BQU8sYUFBYyxHQUFJSCxHQUNDLGlCQUFaQyxRQUNkQSxRQUFvQixXQUFJRCxJQUV4QkQsRUFBaUIsV0FBSUMsSUFSdkIsQ0FTR0ssTUFBTSxXQUNULE8sd0JDVEEsSUFBSUMsRUFBc0IsQ0NBMUIsRUFBd0IsU0FBU0wsRUFBU00sR0FDekMsSUFBSSxJQUFJQyxLQUFPRCxFQUNYRCxFQUFvQkcsRUFBRUYsRUFBWUMsS0FBU0YsRUFBb0JHLEVBQUVSLEVBQVNPLElBQzVFRSxPQUFPQyxlQUFlVixFQUFTTyxFQUFLLENBQUVJLFlBQVksRUFBTUMsSUFBS04sRUFBV0MsTUNKM0UsRUFBd0IsU0FBU00sRUFBS0MsR0FBUSxPQUFPTCxPQUFPTSxVQUFVQyxlQUFlQyxLQUFLSixFQUFLQyxJQ0MvRixFQUF3QixTQUFTZCxHQUNYLG9CQUFYa0IsUUFBMEJBLE9BQU9DLGFBQzFDVixPQUFPQyxlQUFlVixFQUFTa0IsT0FBT0MsWUFBYSxDQUFFQyxNQUFPLFdBRTdEWCxPQUFPQyxlQUFlVixFQUFTLGFBQWMsQ0FBRW9CLE9BQU8sTSxvR0NGdkQsTUFLYUMsRUFBb0JELEdBQzdCRSxLQUFLQyxNQUFPSCxFQUFVLElBTlgsR0NNUixTQUFTSSxFQUFJQyxLQUFjQyxJQ1BsQyxNQUFNLEVER0MsU0FBc0JELEVBQVksZ0JBQ3JDLE9BQU9ELEVBQUlHLFVBQUtDLEVBQVdILEdDSm5CSSxDQUFhLE9BRVYsTUFBTUMsRUFFbkIsS0FBTyxHQUNQLE1BQVEsRUFDUixPQUFTLEVBQ1QsTUFBUSxFQUNSLFVBQVksRUFFWixNQUFRLEdBRVIsWUFBWUMsRUFBTUMsRUFBR0MsRUFBR0MsRUFBR0MsR0FDekIvQixLQUFLMkIsS0FBT0EsRUFDWjNCLEtBQUtnQyxNQUFRZixFQUFpQlcsR0FDOUI1QixLQUFLaUMsT0FBU2hCLEVBQWlCWSxHQUMvQjdCLEtBQUtrQyxNQUFRakIsRUFBaUJhLEdBQzlCOUIsS0FBS21DLFVBQVlsQixFQUFpQmMsR0FHcEMsVUFDRSxPQUFPL0IsS0FBSzJCLEtBR2QsV0FDRSxPQUFPM0IsS0FBS2dDLE1BR2QsWUFDRSxPQUFPaEMsS0FBS2lDLE9BR2QsV0FDRSxPQUFPakMsS0FBS2tDLE1BR2QsZUFDRSxPQUFPbEMsS0FBS21DLFVBR2QsV0FDRSxPQUFPbkMsS0FBS29DLE1BR2QsWUFDRSxPQUFPcEMsS0FBS3FDLFdBQWFyQyxLQUFLc0MsWUFBY3RDLEtBQUt1QyxXQUduRCxrQkFDRSxPQUFPdkMsS0FBS29DLE1BQU1JLFFBQVEsQ0FBRUMsRUFBUUMsSUFBVUQsRUFBU0MsRUFBS0MsYUFBYSxHQUczRSxVQUFVRCxHQUNSLE1BQU1QLEVBQVluQyxLQUFLNEMsZUFDdkIsT0FBU1QsR0FBYU8sRUFBS0MsWUFBYzNDLEtBQUs2QyxtQkFBcUJWLEVBNEJyRSxjQUFjTyxFQUFNSSxHQUNsQkosRUFBS0ksYUFBZUEsRUFDcEIsSUFBSWhCLEVBQUlZLEVBQUtLLGVBR2IsT0FBSy9DLEtBQUtxQyxXQUFhUCxFQUFFLElBQU05QixLQUFLc0MsWUFBY1IsRUFBRSxJQUFNOUIsS0FBS3VDLFdBQWFULEVBQUUsR0FDbkUsRUFJUVosS0FBSzhCLElBQUtsQixFQUFFLEdBQUs5QixLQUFLcUMsV0FBWSxHQUNqQ25CLEtBQUs4QixJQUFLbEIsRUFBRSxHQUFLOUIsS0FBS3NDLFlBQWEsR0FDcENwQixLQUFLOEIsSUFBS2xCLEVBQUUsR0FBSzlCLEtBQUt1QyxXQUFZLEdBV3ZELHFCQUFxQkcsR0FDbkIsTUFBTU8sRUFBaUIsR0FHMUIsSUFBSyxJQUFJQyxFQUFFLEVBQUdBLEVBQUVSLEVBQUtTLGdCQUFnQkMsT0FBUUYsSUFBSyxDQUM5QyxNQUFNRyxFQUFJWCxFQUFLUyxnQkFBZ0JELEdBQ2xDRCxFQUFlSSxHQUFLckQsS0FBS3NELGNBQWVaLEVBQU1XLEdBUzVDLE9BSndCaEQsT0FBT2tELEtBQU1OLEdBQWlCTyxNQUFNLENBQUVDLEVBQUdDLElBQ3hEVCxFQUFlUyxHQUFLVCxFQUFlUSxLQUN4Q0UsSUFBS0MsUUFLWCxRQUFRbEIsRUFBTW1CLEdBQ1osTUFBTUMsRUFBTTlELEtBQ1osSUFBSStELEdBQU0sRUFDVixNQUFNQyxFQUFZaEUsS0FBS2lFLHFCQUFzQnZCLEdBQzdDQSxFQUFLd0IsU0FBV0wsRUFFaEIsSUFBTSxJQUFJWCxFQUFJLEVBQUdBLEVBQUljLEVBQVVaLE9BQVFGLElBQU0sQ0FDM0NSLEVBQUtJLGFBQWVrQixFQUFVZCxHQUM5QixJQUFJcEIsRUFBSVksRUFBS0ssZUFFYixHQUFJZSxFQUFJekIsV0FBYXdCLEVBQUUsR0FBSy9CLEVBQUUsSUFBTWdDLEVBQUl4QixZQUFjdUIsRUFBRSxHQUFLL0IsRUFBRSxJQUFNZ0MsRUFBSXZCLFdBQWFzQixFQUFFLEdBQUsvQixFQUFFLEdBQzdGaUMsR0FBTSxNQUNELENBQ0xBLEdBQU0sRUFFTixJQUFLLElBQUlJLEVBQUUsRUFBR0EsRUFBRUwsRUFBSTFCLE1BQU1nQixPQUFRZSxJQUVoQyxHQURTTCxFQUFJMUIsTUFBTStCLEdBQ1pDLFVBQVUxQixHQUFPLENBQ3RCcUIsR0FBTSxFQUNOLE1BSUFBLEdBQ0ZELEVBQUkxQixNQUFNaUMsS0FBSzNCLEdBTW5CLEdBRkEsRUFBSSxpQkFBa0JxQixFQUFLLE9BQVFyQixFQUFLNEIsV0FBWSxNQUFPUixFQUFJUSxZQUUzRFAsRUFDRixNQUdKLE9BQU9BLEVBR1QsV0FDRSxNQUFPLE9BQU8vRCxLQUFLMkIsaUJBQWlCM0IsS0FBS3FDLGNBQWNyQyxLQUFLc0MsZUFBZXRDLEtBQUt1Qyx3QkFBd0J2QyxLQUFLNEMsbUJDaksxRyxNQVdNMkIsRUFBZ0IsQ0FBQyxFQUFHLEVBQUcsR0FFdkJDLEVBQXNCLENBQ2pDLEVBQW9CLDJCQUNwQixFQUFvQiwyQkFDcEIsRUFBb0IsMkJBQ3BCLEVBQW9CLDJCQUNwQixFQUFvQiwyQkFDcEIsRUFBb0IsNEJBR1AsTUFBTUMsRUFFbkIsS0FBTyxHQUNQLE1BQVEsRUFDUixPQUFTLEVBQ1QsTUFBUSxFQUNSLE9BQVMsRUFDVCxnQkFBa0IsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsR0FFN0IsYUEvQjhCLEVBZ0M5QixTQUFXLEdBRVgsWUFBWTlDLEVBQU1DLEVBQUdDLEVBQUdDLEVBQUc0QyxFQUFJdkIsR0FDN0JuRCxLQUFLMkIsS0FBT0EsRUFDWjNCLEtBQUtnQyxNQUFRZixFQUFpQlcsR0FDOUI1QixLQUFLaUMsT0FBU2hCLEVBQWlCWSxHQUMvQjdCLEtBQUtrQyxNQUFRakIsRUFBaUJhLEdBQzlCOUIsS0FBS3lDLE9BQVN4QixFQUFpQnlELEdBQy9CMUUsS0FBS21ELGdCQUFrQkEsR0FBb0NuRCxLQUFLbUQsZ0JBR2xFLFdBQ0UsT0FBT25ELEtBQUtnQyxNQUdkLFlBQ0UsT0FBT2hDLEtBQUtpQyxPQUdkLFdBQ0UsT0FBT2pDLEtBQUtrQyxNQUdkLFlBQ0UsT0FBT2xDLEtBQUt5QyxPQUdkLGtCQUNFLE9BQU96QyxLQUFLOEMsYUFHZCxxQkFDRSxPQUFPOUMsS0FBS21ELGdCQUdkLHdCQUNFLE9BQU9xQixFQUFvQnhFLEtBQUsyRSxtQkFHbEMsZUFDRSxJQUFJN0MsRUFDSixPQUFROUIsS0FBSzhDLGNBQ1gsS0ExRTBCLEVBMkV4QmhCLEVBQUksQ0FBQzlCLEtBQUtxQyxXQUFZckMsS0FBS3NDLFlBQWF0QyxLQUFLdUMsWUFDN0MsTUFDRixLQTVFMEIsRUE2RXhCVCxFQUFJLENBQUM5QixLQUFLc0MsWUFBYXRDLEtBQUtxQyxXQUFZckMsS0FBS3VDLFlBQzdDLE1BQ0YsS0E5RTBCLEVBK0V4QlQsRUFBSSxDQUFDOUIsS0FBS3NDLFlBQWF0QyxLQUFLdUMsV0FBWXZDLEtBQUtxQyxZQUM3QyxNQUNGLEtBaEYwQixFQWlGeEJQLEVBQUksQ0FBQzlCLEtBQUt1QyxXQUFZdkMsS0FBS3NDLFlBQWF0QyxLQUFLcUMsWUFDN0MsTUFDRixLQWxGMEIsRUFtRnhCUCxFQUFJLENBQUM5QixLQUFLdUMsV0FBWXZDLEtBQUtxQyxXQUFZckMsS0FBS3NDLGFBQzVDLE1BQ0YsS0FwRjBCLEVBcUZ4QlIsRUFBSSxDQUFDOUIsS0FBS3FDLFdBQVlyQyxLQUFLdUMsV0FBWXZDLEtBQUtzQyxhQUdoRCxPQUFPUixFQUdULFVBQVU4QyxHQUNSLE9BQU9DLEVBQWM3RSxLQUFNNEUsRUExRk4sRUFDQyxJQTBGbEJDLEVBQWM3RSxLQUFNNEUsRUExRkYsRUFDRCxJQTBGakJDLEVBQWM3RSxLQUFNNEUsRUE1RkgsRUFFQSxHQTZGdkIsWUFDRSxPQUFPNUUsS0FBS3FDLFdBQWFyQyxLQUFLc0MsWUFBY3RDLEtBQUt1QyxXQUduRCxXQUNFLE1BQU8sUUFBUXZDLEtBQUsyQixTQUFTM0IsS0FBSzhFLDZCQUE2QjlFLEtBQUsrQyxlQUFlZ0MsS0FBSyxlQUFlL0UsS0FBS3lDLFdBSXpHLE1BQU1vQyxFQUFnQixDQUFDRyxFQUFJSixFQUFJSyxFQUFHQyxLQUN2QyxJQUFJQyxFQUFJQyxFQUFJQyxFQUFLQyxFQUFLQyxFQUFLQyxFQUFLQyxFQUFJQyxFQWFwQyxPQVhBUCxFQUFLSCxFQUFHakMsZUFDUnFDLEVBQUtSLEVBQUc3QixlQUVSc0MsRUFBTUwsRUFBR2QsU0FBU2UsR0FBS0UsRUFBR0YsR0FBSyxFQUMvQkssRUFBTU4sRUFBR2QsU0FBU2dCLEdBQUtDLEVBQUdELEdBQUssRUFDL0JLLEVBQU1YLEVBQUdWLFNBQVNlLEdBQUtHLEVBQUdILEdBQUssRUFDL0JPLEVBQU1aLEVBQUdWLFNBQVNnQixHQUFLRSxFQUFHRixHQUFLLEVBRS9CTyxFQUFLdkUsS0FBS3lFLElBQUlOLEVBQUtFLEdBQU9yRSxLQUFLMEUsSUFBSVAsRUFBS0UsR0FDeENHLEVBQUt4RSxLQUFLeUUsSUFBSUwsRUFBS0UsR0FBT3RFLEtBQUswRSxJQUFJTixFQUFLRSxHQUVqQ0MsR0FBTU4sRUFBR0YsR0FBS0csRUFBR0gsSUFBTSxHQUFLUyxHQUFNUCxFQUFHRCxHQUFLRSxFQUFHRixJQUFNLEdDdEg3QyxNQUFNVyxFQUVuQixLQUFPLEdBQ1AsTUFBUSxHQUNSLFdBQWEsR0FFYixPQUFPQyxHQUNMOUYsS0FBSytGLEtBQUsxQixLQUFLeUIsR0FHakIsUUFBUXBELEdBQ04xQyxLQUFLb0MsTUFBTWlDLEtBQUszQixHQUdsQixjQUFjUSxHQUNaLElBQUssSUFBSThDLEVBQUcsRUFBR0EsRUFBR2hHLEtBQUsrRixLQUFLM0MsT0FBUTRDLElBQU0sQ0FDeEMsSUFBSXRDLEVBQUkxRCxLQUFLK0YsS0FBS0MsR0FFbEIsR0FBS3RDLEVBQUV1QyxVQUFVL0MsSUFBT1EsRUFBRXdDLFFBQVFoRCxFQUFHcUIsR0FRckMsT0FKdUIsSUFBbkJiLEVBQUV0QixNQUFNZ0IsUUFBZ0JNLEVBQUV0QixNQUFNLEtBQU9jLElBQ3pDUSxFQUFFdEIsTUFBUSxJQUdMc0IsRUFFVCxPQUFPLEtBR1QsaUJBQWlCQSxHQUNmLElBQUl5QyxFQUFJekMsRUFBRTBDLFlBQ1YsSUFBSyxJQUFJSixFQUFHLEVBQUdBLEVBQUdoRyxLQUFLK0YsS0FBTUMsSUFBTSxDQUNqQyxJQUFJSyxFQUFLckcsS0FBSytGLEtBQUtDLEdBQ25CLEdBQUlLLEVBQUdELFlBQWNELEVBQ25CLE9BQU9FLEVBR1gsT0FBTyxLQUdULFlBQzRCLElBQXRCckcsS0FBS29DLE1BQU1nQixTQUdmcEQsS0FBS3NHLFdBQVdqQyxLQUFLckUsS0FBS29DLE1BQU0sSUFDaENwQyxLQUFLb0MsTUFBTW1FLE9BQU8sRUFBRyxJQUd2QixVQUFVN0MsRUFBR3RCLEdBQ1gsSUFBSWlFLEVBQUssS0FDTEcsRUFBVyxHQUdmLElBRlU5QyxFQUFFdUMsVUFBVTdELEVBQU0sTUFBT3NCLEVBQUV3QyxRQUFROUQsRUFBTSxHQUFJbUMsR0FFN0MsQ0FDUixJQUFJOEIsRUFBS3JHLEtBQUt5RyxpQkFBaUIvQyxHQUMvQixPQUFJMkMsRUFDS3JHLEtBQUswRyxVQUFVTCxFQUFJakUsR0FFckJwQyxLQUFLb0MsTUFJZCxJQUFLLElBQUk0RCxFQUFHLEVBQUdBLEVBQUtoRyxLQUFLb0MsTUFBTWdCLE9BQVE0QyxJQUFNLENBQzNDLElBQUlXLEdBQVMsRUFDVGpFLEVBQU8xQyxLQUFLb0MsTUFBTTRELEdBRXRCLEdBQUl0QyxFQUFFdUMsVUFBVXZELEdBR2RrRSxFQUNBLElBQUssSUFBSUMsRUFBSSxFQUFHQSxFQUFNLEVBQUdBLElBQ3ZCLElBQUssSUFBSUMsRUFBRyxFQUFHQSxFQUFLcEQsRUFBRXRCLE1BQU1nQixPQUFRMEQsSUFBTSxDQUN4QyxJQUFJQyxFQUNBQyxFQUFLdEQsRUFBRXRCLE1BQU0wRSxHQUNiaEYsRUFBSWtGLEVBQUdqRSxlQUNYLE9BQVE4RCxHQUNOLEtEOUVXLEVDK0VURSxFQUFLLENBQUNDLEVBQUc5QyxTQUFTLEdBQUtwQyxFQUFFLEdBQUlrRixFQUFHOUMsU0FBUyxHQUFJOEMsRUFBRzlDLFNBQVMsSUFDekQsTUFDRixLRGhGWSxFQ2lGVjZDLEVBQUssQ0FBQ0MsRUFBRzlDLFNBQVMsR0FBSThDLEVBQUc5QyxTQUFTLEdBQUtwQyxFQUFFLEdBQUlrRixFQUFHOUMsU0FBUyxJQUN6RCxNQUNGLEtEbEZXLEVDbUZUNkMsRUFBSyxDQUFDQyxFQUFHOUMsU0FBUyxHQUFJOEMsRUFBRzlDLFNBQVMsR0FBSThDLEVBQUc5QyxTQUFTLEdBQUtwQyxFQUFFLElBSTdELEdBQUk0QixFQUFFd0MsUUFBUXhELEVBQU1xRSxHQUFLLENBQ3ZCSixHQUFTLEVBQ1QsTUFBTUMsR0FNZCxJQUFLRCxFQUFRLENBQ1gsS0FBYyxPQUFQTixHQUVMLEdBREFBLEVBQUtyRyxLQUFLeUcsaUJBQWlCL0MsR0FDdkIyQyxJQUNGQSxFQUFHakUsTUFBTWlDLEtBQUszQixHQUVNLElBRFQxQyxLQUFLMEcsVUFBVUwsRUFBSUEsRUFBR2pFLE9BQ3hCZ0IsUUFBYyxDQUNyQk0sRUFBSTJDLEVBQ0pNLEdBQVMsRUFDVCxNQUtEQSxHQUNISCxFQUFTbkMsS0FBSzNCLElBS3BCLE9BQU84RCxFQUdULE9BV0UsSUFUQXhHLEtBQUsrRixLQUFLdkMsTUFBSyxDQUFDQyxFQUFHQyxJQUNWRCxFQUFFMkMsWUFBYzFDLEVBQUUwQyxjQUkzQnBHLEtBQUtvQyxNQUFNb0IsTUFBSyxDQUFDQyxFQUFHQyxJQUNYQSxFQUFFMEMsWUFBYzNDLEVBQUUyQyxjQUdwQnBHLEtBQUtvQyxNQUFNZ0IsT0FBUyxHQUFHLENBQzVCLElBQUkwQyxFQUFNOUYsS0FBS2lILGNBQWNqSCxLQUFLb0MsTUFBTSxJQUU1QixPQUFSMEQsRUFLSjlGLEtBQUtvQyxNQUFRcEMsS0FBSzBHLFVBQVVaLEVBQUs5RixLQUFLb0MsT0FKcENwQyxLQUFLa0gsWUFPVCxPQUFPLE0iLCJmaWxlIjoiQlAzRC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShcIkJpblBhY2tpbmdcIiwgW10sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiQmluUGFja2luZ1wiXSA9IGZhY3RvcnkoKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJCaW5QYWNraW5nXCJdID0gZmFjdG9yeSgpO1xufSkodGhpcywgZnVuY3Rpb24oKSB7XG5yZXR1cm4gIiwiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIGRlZmluaXRpb24pIHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqLCBwcm9wKSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKTsgfSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiLyoqXG4gKiBQcmVjaXNpb24gdG8gcmV0YWluIGluIGZhY3RvcmVkSW50ZWdlcigpXG4gKi9cbmNvbnN0IEZBQ1RPUiA9IDU7XG5cbi8qKlxuICogRmFjdG9yIGEgbnVtYmVyIGJ5IEZBQ1RPUiBhbmQgcm91bmQgdG8gdGhlIG5lYXJlc3Qgd2hvbGUgbnVtYmVyXG4gKi9cbmV4cG9ydCBjb25zdCBmYWN0b3JlZEludGVnZXIgPSAoIHZhbHVlICkgPT4gKFxuICAgIE1hdGgucm91bmQoIHZhbHVlICogKCAxMCAqKiBGQUNUT1IgKSApXG4pO1xuIiwibGV0IGlzTG9nRW5hYmxlZCA9IGZhbHNlO1xuZXhwb3J0IGZ1bmN0aW9uIGVuYWJsZUxvZyhlbmFibGUgPSB0cnVlKSB7XG4gICAgaXNMb2dFbmFibGVkID0gZW5hYmxlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTG9nZ2VyKG5hbWVzcGFjZSA9ICdiaW5wYWNraW5nanMnKSB7XG4gICAgcmV0dXJuIGxvZy5iaW5kKHVuZGVmaW5lZCwgbmFtZXNwYWNlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxvZyhuYW1lc3BhY2UsIC4uLmFyZ3MpIHtcbiAgICByZXR1cm4gaXNMb2dFbmFibGVkID8gY29uc29sZS5kZWJ1Zy5hcHBseShjb25zb2xlLCBbbmFtZXNwYWNlXS5jb25jYXQoYXJncykpIDogdW5kZWZpbmVkO1xufSIsImltcG9ydCB7IGZhY3RvcmVkSW50ZWdlciB9IGZyb20gJy4vdXRpbCc7XG5pbXBvcnQge2NyZWF0ZUxvZ2dlcn0gZnJvbSBcIi4uL2xpYi9sb2dcIjtcbmNvbnN0IGxvZyA9IGNyZWF0ZUxvZ2dlcignM0Q6Jyk7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJpbiB7XG5cbiAgbmFtZSA9ICcnO1xuICB3aWR0aCA9IDA7XG4gIGhlaWdodCA9IDA7XG4gIGRlcHRoID0gMDtcbiAgbWF4V2VpZ2h0ID0gMDtcblxuICBpdGVtcyA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKG5hbWUsIHcsIGgsIGQsIG13KSB7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB0aGlzLndpZHRoID0gZmFjdG9yZWRJbnRlZ2VyKCB3ICk7XG4gICAgdGhpcy5oZWlnaHQgPSBmYWN0b3JlZEludGVnZXIoIGggKTtcbiAgICB0aGlzLmRlcHRoID0gZmFjdG9yZWRJbnRlZ2VyKCBkICk7XG4gICAgdGhpcy5tYXhXZWlnaHQgPSBmYWN0b3JlZEludGVnZXIoIG13ICk7XG4gIH1cblxuICBnZXROYW1lKCkge1xuICAgIHJldHVybiB0aGlzLm5hbWU7XG4gIH1cblxuICBnZXRXaWR0aCgpIHtcbiAgICByZXR1cm4gdGhpcy53aWR0aDtcbiAgfVxuXG4gIGdldEhlaWdodCgpIHtcbiAgICByZXR1cm4gdGhpcy5oZWlnaHQ7XG4gIH1cblxuICBnZXREZXB0aCgpIHtcbiAgICByZXR1cm4gdGhpcy5kZXB0aDtcbiAgfVxuXG4gIGdldE1heFdlaWdodCgpIHtcbiAgICByZXR1cm4gdGhpcy5tYXhXZWlnaHQ7XG4gIH1cblxuICBnZXRJdGVtcygpIHtcbiAgICByZXR1cm4gdGhpcy5pdGVtcztcbiAgfVxuXG4gIGdldFZvbHVtZSgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRXaWR0aCgpICogdGhpcy5nZXRIZWlnaHQoKSAqIHRoaXMuZ2V0RGVwdGgoKTtcbiAgfVxuXG4gIGdldFBhY2tlZFdlaWdodCgpIHtcbiAgICByZXR1cm4gdGhpcy5pdGVtcy5yZWR1Y2UoICggd2VpZ2h0LCBpdGVtICkgPT4gd2VpZ2h0ICsgaXRlbS5nZXRXZWlnaHQoKSwgMCApO1xuICB9XG5cbiAgd2VpZ2hJdGVtKGl0ZW0pIHtcbiAgICBjb25zdCBtYXhXZWlnaHQgPSB0aGlzLmdldE1heFdlaWdodCgpO1xuICAgIHJldHVybiAhIG1heFdlaWdodCB8fCBpdGVtLmdldFdlaWdodCgpICsgdGhpcy5nZXRQYWNrZWRXZWlnaHQoKSA8PSBtYXhXZWlnaHQ7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIGEgc2NvcmUgZm9yIGEgZ2l2ZW4gaXRlbSBhbmQgcm90YXRpb24gdHlwZS5cbiAgICpcbiAgICogU2NvcmVzIGFyZSBoaWdoZXIgZm9yIHJvdGF0aW9ucyB0aGF0IGNsb3Nlc3QgbWF0Y2ggaXRlbSBkaW1lbnNpb25zIHRvIEJpbiBkaW1lbnNpb25zLlxuICAgKiBGb3IgZXhhbXBsZSwgcm90YXRpbmcgdGhlIGl0ZW0gc28gdGhlIGxvbmdlc3Qgc2lkZSBpcyBhbGlnbmVkIHdpdGggdGhlIGxvbmdlc3QgQmluIHNpZGUuXG4gICAqXG4gICAqIEV4YW1wbGUgKEJpbiBpcyAxMSB4IDguNSB4IDUuNSwgSXRlbSBpcyA4LjEgeCA1LjIgeCA1LjIpOlxuICAgKiAgUm90YXRpb24gMDpcbiAgICogICAgOC4xIC8gMTEgID0gMC43MzZcbiAgICogICAgNS4yIC8gOC41ID0gMC42MTJcbiAgICogICAgNS4yIC8gNS41ID0gMC45NDVcbiAgICogICAgLS0tLS0tLS0tLS0tLS0tLS1cbiAgICogICAgMC43MzYgKiogMiArIDAuNjEyICoqIDIgKyAwLjk0NSAqKiAyID0gMS44MDlcbiAgICpcbiAgICogIFJvdGF0aW9uIDE6XG4gICAqICAgIDguMSAvIDguNSA9IDAuOTUzXG4gICAqICAgIDUuMiAvIDExID0gMC40NzNcbiAgICogICAgNS4yIC8gNS41ID0gMC45NDVcbiAgICogICAgLS0tLS0tLS0tLS0tLS0tLS1cbiAgICogICAgMC45NTMgKiogMiArIDAuNDczICoqIDIgKyAwLjk0NSAqKiAyID0gMi4wMjVcbiAgICpcbiAgICogQHBhcmFtIHtJdGVtfSBpdGVtXG4gICAqIEBwYXJhbSB7aW50fSByb3RhdGlvblR5cGVcbiAgICogQHJldHVybiB7ZmxvYXR9IHNjb3JlXG4gICAqL1xuICBzY29yZVJvdGF0aW9uKGl0ZW0sIHJvdGF0aW9uVHlwZSkge1xuICAgIGl0ZW0ucm90YXRpb25UeXBlID0gcm90YXRpb25UeXBlO1xuICAgIGxldCBkID0gaXRlbS5nZXREaW1lbnNpb24oKTtcblxuICAgIC8vIElmIHRoZSBpdGVtIGRvZXNuJ3QgZml0IGluIHRoZSBCaW5cbiAgICBpZiAoIHRoaXMuZ2V0V2lkdGgoKSA8IGRbMF0gfHwgdGhpcy5nZXRIZWlnaHQoKSA8IGRbMV0gfHwgdGhpcy5nZXREZXB0aCgpIDwgZFsyXSApIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgLy8gU3F1YXJlIHRoZSByZXN1bHRzIHRvIGluY3JlYXNlIHRoZSBpbXBhY3Qgb2YgaGlnaCB2YWx1ZXMgKGUuZy4gPiAwLjgpXG4gICAgY29uc3Qgd2lkdGhTY29yZSA9IE1hdGgucG93KCBkWzBdIC8gdGhpcy5nZXRXaWR0aCgpLCAyICk7XG4gICAgY29uc3QgaGVpZ2h0U2NvcmUgPSBNYXRoLnBvdyggZFsxXSAvIHRoaXMuZ2V0SGVpZ2h0KCksIDIgKTtcbiAgICBjb25zdCBkZXB0aFNjb3JlID0gTWF0aC5wb3coIGRbMl0gLyB0aGlzLmdldERlcHRoKCksIDIgKTtcblxuICAgIHJldHVybiB3aWR0aFNjb3JlICsgaGVpZ2h0U2NvcmUgKyBkZXB0aFNjb3JlO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSB0aGUgYmVzdCByb3RhdGlvbiBvcmRlciBmb3IgYSBnaXZlbiBJdGVtIGJhc2VkIG9uIHNjb3JlUm90YXRpb24oKS5cbiAgICpcbiAgICogQHBhcmFtIHtJdGVtfSBpdGVtXG4gICAqIEByZXR1cm4ge0FycmF5fSBSb3RhdGlvbiB0eXBlcyBzb3J0ZWQgYnkgdGhlaXIgc2NvcmUsIERFU0NcbiAgICovXG4gIGdldEJlc3RSb3RhdGlvbk9yZGVyKGl0ZW0pIHtcbiAgICBjb25zdCByb3RhdGlvblNjb3JlcyA9IHt9O1xuXG4gICAgLy8gU2NvcmUgYWxsIHJvdGF0aW9uIHR5cGVzXG5cdGZvciAobGV0IGk9MDsgaTxpdGVtLmFsbG93ZWRSb3RhdGlvbi5sZW5ndGg7IGkrKykge1xuXHQgICAgY29uc3QgciA9IGl0ZW0uYWxsb3dlZFJvdGF0aW9uW2ldO1xuXHRcdHJvdGF0aW9uU2NvcmVzW3JdID0gdGhpcy5zY29yZVJvdGF0aW9uKCBpdGVtLCByICk7XG4gICAgfVxuXG4gICAgLy8gU29ydCB0aGUgcm90YXRpb24gdHlwZXMgKGluZGV4IG9mIHNjb3JlcyBvYmplY3QpIERFU0NcbiAgICAvLyBhbmQgZW5zdXJlIEludCB2YWx1ZXMgKE9iamVjdC5rZXlzIHJldHVybnMgc3RyaW5ncylcbiAgICBjb25zdCBzb3J0ZWRSb3RhdGlvbnMgPSBPYmplY3Qua2V5cyggcm90YXRpb25TY29yZXMgKS5zb3J0KCAoIGEsIGIgKSA9PiB7XG4gICAgICByZXR1cm4gcm90YXRpb25TY29yZXNbYl0gLSByb3RhdGlvblNjb3Jlc1thXTtcbiAgICB9ICkubWFwKCBOdW1iZXIgKTtcblxuICAgIHJldHVybiBzb3J0ZWRSb3RhdGlvbnM7XG4gIH1cblxuICBwdXRJdGVtKGl0ZW0sIHApIHtcbiAgICBjb25zdCBib3ggPSB0aGlzO1xuICAgIGxldCBmaXQgPSBmYWxzZTtcbiAgICBjb25zdCByb3RhdGlvbnMgPSB0aGlzLmdldEJlc3RSb3RhdGlvbk9yZGVyKCBpdGVtICk7XG4gICAgaXRlbS5wb3NpdGlvbiA9IHA7XG5cbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCByb3RhdGlvbnMubGVuZ3RoOyBpKysgKSB7XG4gICAgICBpdGVtLnJvdGF0aW9uVHlwZSA9IHJvdGF0aW9uc1tpXTtcbiAgICAgIGxldCBkID0gaXRlbS5nZXREaW1lbnNpb24oKTtcblxuICAgICAgaWYgKGJveC5nZXRXaWR0aCgpIDwgcFswXSArIGRbMF0gfHwgYm94LmdldEhlaWdodCgpIDwgcFsxXSArIGRbMV0gfHwgYm94LmdldERlcHRoKCkgPCBwWzJdICsgZFsyXSkge1xuICAgICAgICBmaXQgPSBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZpdCA9IHRydWU7XG5cbiAgICAgICAgZm9yIChsZXQgaj0wOyBqPGJveC5pdGVtcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgIGxldCBfaiA9IGJveC5pdGVtc1tqXTtcbiAgICAgICAgICBpZiAoX2ouaW50ZXJzZWN0KGl0ZW0pKSB7XG4gICAgICAgICAgICBmaXQgPSBmYWxzZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChmaXQpIHtcbiAgICAgICAgICBib3guaXRlbXMucHVzaChpdGVtKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBsb2coJ3RyeSB0byBwdXRJdGVtJywgZml0LCAnaXRlbScsIGl0ZW0udG9TdHJpbmcoKSwgJ2JveCcsIGJveC50b1N0cmluZygpKTtcblxuICAgICAgaWYgKGZpdCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZpdDtcbiAgfVxuXG4gIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiBgQmluOiR7dGhpcy5uYW1lfSAoV3hIeEQgPSAke3RoaXMuZ2V0V2lkdGgoKX14JHt0aGlzLmdldEhlaWdodCgpfXgke3RoaXMuZ2V0RGVwdGgoKX0sIE1heFdnLiA9ICR7dGhpcy5nZXRNYXhXZWlnaHQoKX0pYDtcbiAgfVxuXG59IiwiaW1wb3J0IHsgZmFjdG9yZWRJbnRlZ2VyIH0gZnJvbSAnLi91dGlsJztcblxuZXhwb3J0IGNvbnN0IFJvdGF0aW9uVHlwZV9XSEQgPSAwO1xuZXhwb3J0IGNvbnN0IFJvdGF0aW9uVHlwZV9IV0QgPSAxO1xuZXhwb3J0IGNvbnN0IFJvdGF0aW9uVHlwZV9IRFcgPSAyO1xuZXhwb3J0IGNvbnN0IFJvdGF0aW9uVHlwZV9ESFcgPSAzO1xuZXhwb3J0IGNvbnN0IFJvdGF0aW9uVHlwZV9EV0ggPSA0O1xuZXhwb3J0IGNvbnN0IFJvdGF0aW9uVHlwZV9XREggPSA1O1xuXG5leHBvcnQgY29uc3QgV2lkdGhBeGlzID0gMDtcbmV4cG9ydCBjb25zdCBIZWlnaHRBeGlzID0gMTtcbmV4cG9ydCBjb25zdCBEZXB0aEF4aXMgPSAyO1xuXG5leHBvcnQgY29uc3QgU3RhcnRQb3NpdGlvbiA9IFswLCAwLCAwXTtcblxuZXhwb3J0IGNvbnN0IFJvdGF0aW9uVHlwZVN0cmluZ3MgPSB7XG4gIFtSb3RhdGlvblR5cGVfV0hEXTogJ1JvdGF0aW9uVHlwZV9XSEQgKHcsaCxkKScsXG4gIFtSb3RhdGlvblR5cGVfSFdEXTogJ1JvdGF0aW9uVHlwZV9IV0QgKGgsdyxkKScsXG4gIFtSb3RhdGlvblR5cGVfSERXXTogJ1JvdGF0aW9uVHlwZV9IRFcgKGgsZCx3KScsXG4gIFtSb3RhdGlvblR5cGVfREhXXTogJ1JvdGF0aW9uVHlwZV9ESFcgKGQsaCx3KScsXG4gIFtSb3RhdGlvblR5cGVfRFdIXTogJ1JvdGF0aW9uVHlwZV9EV0ggKGQsdyxoKScsXG4gIFtSb3RhdGlvblR5cGVfV0RIXTogJ1JvdGF0aW9uVHlwZV9XREggKHcsZCxoKScsXG59O1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBJdGVtIHtcblxuICBuYW1lID0gJyc7XG4gIHdpZHRoID0gMDtcbiAgaGVpZ2h0ID0gMDtcbiAgZGVwdGggPSAwO1xuICB3ZWlnaHQgPSAwO1xuICBhbGxvd2VkUm90YXRpb24gPSBbMCwxLDIsMyw0LDVdO1xuXG4gIHJvdGF0aW9uVHlwZSA9IFJvdGF0aW9uVHlwZV9XSEQ7XG4gIHBvc2l0aW9uID0gW107IC8vIHgsIHksIHpcblxuICBjb25zdHJ1Y3RvcihuYW1lLCB3LCBoLCBkLCB3ZywgYWxsb3dlZFJvdGF0aW9uKSB7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB0aGlzLndpZHRoID0gZmFjdG9yZWRJbnRlZ2VyKCB3ICk7XG4gICAgdGhpcy5oZWlnaHQgPSBmYWN0b3JlZEludGVnZXIoIGggKTtcbiAgICB0aGlzLmRlcHRoID0gZmFjdG9yZWRJbnRlZ2VyKCBkICk7XG4gICAgdGhpcy53ZWlnaHQgPSBmYWN0b3JlZEludGVnZXIoIHdnICk7XG4gICAgdGhpcy5hbGxvd2VkUm90YXRpb24gPSBhbGxvd2VkUm90YXRpb24gPyBhbGxvd2VkUm90YXRpb24gOiB0aGlzLmFsbG93ZWRSb3RhdGlvbjtcbiAgfVxuXG4gIGdldFdpZHRoKCkge1xuICAgIHJldHVybiB0aGlzLndpZHRoO1xuICB9XG5cbiAgZ2V0SGVpZ2h0KCkge1xuICAgIHJldHVybiB0aGlzLmhlaWdodDtcbiAgfVxuXG4gIGdldERlcHRoKCkge1xuICAgIHJldHVybiB0aGlzLmRlcHRoO1xuICB9XG5cbiAgZ2V0V2VpZ2h0KCkge1xuICAgIHJldHVybiB0aGlzLndlaWdodDtcbiAgfVxuXG4gIGdldFJvdGF0aW9uVHlwZSgpIHtcbiAgICByZXR1cm4gdGhpcy5yb3RhdGlvblR5cGU7XG4gIH1cblxuICBnZXRBbGxvd2VkUm90YXRpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuYWxsb3dlZFJvdGF0aW9uO1xuICB9XG5cbiAgZ2V0Um90YXRpb25UeXBlU3RyaW5nKCkge1xuICAgIHJldHVybiBSb3RhdGlvblR5cGVTdHJpbmdzW3RoaXMuZ2V0Um90YXRpb25UeXBlKCldO1xuICB9XG5cbiAgZ2V0RGltZW5zaW9uKCkge1xuICAgIGxldCBkO1xuICAgIHN3aXRjaCAodGhpcy5yb3RhdGlvblR5cGUpIHtcbiAgICAgIGNhc2UgUm90YXRpb25UeXBlX1dIRDpcbiAgICAgICAgZCA9IFt0aGlzLmdldFdpZHRoKCksIHRoaXMuZ2V0SGVpZ2h0KCksIHRoaXMuZ2V0RGVwdGgoKV07XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBSb3RhdGlvblR5cGVfSFdEOlxuICAgICAgICBkID0gW3RoaXMuZ2V0SGVpZ2h0KCksIHRoaXMuZ2V0V2lkdGgoKSwgdGhpcy5nZXREZXB0aCgpXTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFJvdGF0aW9uVHlwZV9IRFc6XG4gICAgICAgIGQgPSBbdGhpcy5nZXRIZWlnaHQoKSwgdGhpcy5nZXREZXB0aCgpLCB0aGlzLmdldFdpZHRoKCldO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgUm90YXRpb25UeXBlX0RIVzpcbiAgICAgICAgZCA9IFt0aGlzLmdldERlcHRoKCksIHRoaXMuZ2V0SGVpZ2h0KCksIHRoaXMuZ2V0V2lkdGgoKV07XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBSb3RhdGlvblR5cGVfRFdIOlxuICAgICAgICBkID0gW3RoaXMuZ2V0RGVwdGgoKSwgdGhpcy5nZXRXaWR0aCgpLCB0aGlzLmdldEhlaWdodCgpXTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFJvdGF0aW9uVHlwZV9XREg6XG4gICAgICAgIGQgPSBbdGhpcy5nZXRXaWR0aCgpLCB0aGlzLmdldERlcHRoKCksIHRoaXMuZ2V0SGVpZ2h0KCldO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIGQ7XG4gIH1cblxuICBpbnRlcnNlY3QoaTIpIHtcbiAgICByZXR1cm4gcmVjdEludGVyc2VjdCh0aGlzLCBpMiwgV2lkdGhBeGlzLCBIZWlnaHRBeGlzKSAmJlxuICAgICAgICByZWN0SW50ZXJzZWN0KHRoaXMsIGkyLCBIZWlnaHRBeGlzLCBEZXB0aEF4aXMpICYmXG4gICAgICAgIHJlY3RJbnRlcnNlY3QodGhpcywgaTIsIFdpZHRoQXhpcywgRGVwdGhBeGlzKTtcbiAgfVxuXG4gIGdldFZvbHVtZSgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRXaWR0aCgpICogdGhpcy5nZXRIZWlnaHQoKSAqIHRoaXMuZ2V0RGVwdGgoKTtcbiAgfVxuXG4gIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiBgSXRlbToke3RoaXMubmFtZX0gKCR7dGhpcy5nZXRSb3RhdGlvblR5cGVTdHJpbmcoKX0gPSAke3RoaXMuZ2V0RGltZW5zaW9uKCkuam9pbigneCcpfSwgV2cuID0gJHt0aGlzLndlaWdodH0pYDtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgcmVjdEludGVyc2VjdCA9IChpMSwgaTIsIHgsIHkpID0+IHtcbiAgbGV0IGQxLCBkMiwgY3gxLCBjeTEsIGN4MiwgY3kyLCBpeCwgaXk7XG5cbiAgZDEgPSBpMS5nZXREaW1lbnNpb24oKTtcbiAgZDIgPSBpMi5nZXREaW1lbnNpb24oKTtcblxuICBjeDEgPSBpMS5wb3NpdGlvblt4XSArIGQxW3hdIC8gMjtcbiAgY3kxID0gaTEucG9zaXRpb25beV0gKyBkMVt5XSAvIDI7XG4gIGN4MiA9IGkyLnBvc2l0aW9uW3hdICsgZDJbeF0gLyAyO1xuICBjeTIgPSBpMi5wb3NpdGlvblt5XSArIGQyW3ldIC8gMjtcblxuICBpeCA9IE1hdGgubWF4KGN4MSwgY3gyKSAtIE1hdGgubWluKGN4MSwgY3gyKTtcbiAgaXkgPSBNYXRoLm1heChjeTEsIGN5MikgLSBNYXRoLm1pbihjeTEsIGN5Mik7XG5cbiAgcmV0dXJuIGl4IDwgKGQxW3hdICsgZDJbeF0pIC8gMiAmJiBpeSA8IChkMVt5XSArIGQyW3ldKSAvIDI7XG59OyIsImltcG9ydCBCaW4gZnJvbSAnLi9CaW4nO1xuaW1wb3J0IHtcbiAgSXRlbSxcbiAgU3RhcnRQb3NpdGlvbixcbiAgV2lkdGhBeGlzLFxuICBIZWlnaHRBeGlzLFxuICBEZXB0aEF4aXNcbn0gZnJvbSAnLi9JdGVtJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGFja2VyIHtcblxuICBiaW5zID0gW107XG4gIGl0ZW1zID0gW107XG4gIHVuZml0SXRlbXMgPSBbXTtcblxuICBhZGRCaW4oYmluKSB7XG4gICAgdGhpcy5iaW5zLnB1c2goYmluKTtcbiAgfVxuXG4gIGFkZEl0ZW0oaXRlbSkge1xuICAgIHRoaXMuaXRlbXMucHVzaChpdGVtKTtcbiAgfVxuXG4gIGZpbmRGaXR0ZWRCaW4oaSkge1xuICAgIGZvciAobGV0IF9pPTA7IF9pPHRoaXMuYmlucy5sZW5ndGg7IF9pKyspIHtcbiAgICAgIGxldCBiID0gdGhpcy5iaW5zW19pXTtcblxuICAgICAgaWYgKCFiLndlaWdoSXRlbShpKSB8fCAhYi5wdXRJdGVtKGksIFN0YXJ0UG9zaXRpb24pKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAoYi5pdGVtcy5sZW5ndGggPT09IDEgJiYgYi5pdGVtc1swXSA9PT0gaSkge1xuICAgICAgICBiLml0ZW1zID0gW107XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBiO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGdldEJpZ2dlckJpblRoYW4oYikge1xuICAgIGxldCB2ID0gYi5nZXRWb2x1bWUoKTtcbiAgICBmb3IgKGxldCBfaT0wOyBfaTx0aGlzLmJpbnM7IF9pKyspIHtcbiAgICAgIGxldCBiMiA9IHRoaXMuYmluc1tfaV07XG4gICAgICBpZiAoYjIuZ2V0Vm9sdW1lKCkgPiB2KSB7XG4gICAgICAgIHJldHVybiBiMjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICB1bmZpdEl0ZW0oKSB7XG4gICAgaWYgKHRoaXMuaXRlbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMudW5maXRJdGVtcy5wdXNoKHRoaXMuaXRlbXNbMF0pO1xuICAgIHRoaXMuaXRlbXMuc3BsaWNlKDAsIDEpO1xuICB9XG5cbiAgcGFja1RvQmluKGIsIGl0ZW1zKSB7XG4gICAgbGV0IGIyID0gbnVsbDtcbiAgICBsZXQgdW5wYWNrZWQgPSBbXTtcbiAgICBsZXQgZml0ID0gYi53ZWlnaEl0ZW0oaXRlbXNbMF0pICYmIGIucHV0SXRlbShpdGVtc1swXSwgU3RhcnRQb3NpdGlvbik7XG5cbiAgICBpZiAoIWZpdCkge1xuICAgICAgbGV0IGIyID0gdGhpcy5nZXRCaWdnZXJCaW5UaGFuKGIpO1xuICAgICAgaWYgKGIyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhY2tUb0JpbihiMiwgaXRlbXMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuaXRlbXM7XG4gICAgfVxuXG4gICAgLy8gUGFjayB1bnBhY2tlZCBpdGVtcy5cbiAgICBmb3IgKGxldCBfaT0xOyBfaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICBsZXQgZml0dGVkID0gZmFsc2U7XG4gICAgICBsZXQgaXRlbSA9IHRoaXMuaXRlbXNbX2ldO1xuXG4gICAgICBpZiAoYi53ZWlnaEl0ZW0oaXRlbSkpIHtcbiAgICAgICAgLy8gVHJ5IGF2YWlsYWJsZSBwaXZvdHMgaW4gY3VycmVudCBiaW4gdGhhdCBhcmUgbm90IGludGVyc2VjdCB3aXRoXG4gICAgICAgIC8vIGV4aXN0aW5nIGl0ZW1zIGluIGN1cnJlbnQgYmluLlxuICAgICAgICBsb29rdXA6XG4gICAgICAgIGZvciAobGV0IF9wdD0wOyBfcHQgPCAzOyBfcHQrKykge1xuICAgICAgICAgIGZvciAobGV0IF9qPTA7IF9qIDwgYi5pdGVtcy5sZW5ndGg7IF9qKyspIHtcbiAgICAgICAgICAgIGxldCBwdjtcbiAgICAgICAgICAgIGxldCBpYiA9IGIuaXRlbXNbX2pdO1xuICAgICAgICAgICAgbGV0IGQgPSBpYi5nZXREaW1lbnNpb24oKTtcbiAgICAgICAgICAgIHN3aXRjaCAoX3B0KSB7XG4gICAgICAgICAgICAgIGNhc2UgV2lkdGhBeGlzOlxuICAgICAgICAgICAgICAgIHB2ID0gW2liLnBvc2l0aW9uWzBdICsgZFswXSwgaWIucG9zaXRpb25bMV0sIGliLnBvc2l0aW9uWzJdXTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSBIZWlnaHRBeGlzOlxuICAgICAgICAgICAgICAgIHB2ID0gW2liLnBvc2l0aW9uWzBdLCBpYi5wb3NpdGlvblsxXSArIGRbMV0sIGliLnBvc2l0aW9uWzJdXTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSBEZXB0aEF4aXM6XG4gICAgICAgICAgICAgICAgcHYgPSBbaWIucG9zaXRpb25bMF0sIGliLnBvc2l0aW9uWzFdLCBpYi5wb3NpdGlvblsyXSArIGRbMl1dO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYi5wdXRJdGVtKGl0ZW0sIHB2KSkge1xuICAgICAgICAgICAgICBmaXR0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICBicmVhayBsb29rdXA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghZml0dGVkKSB7XG4gICAgICAgIHdoaWxlIChiMiAhPT0gbnVsbCkge1xuICAgICAgICAgIGIyID0gdGhpcy5nZXRCaWdnZXJCaW5UaGFuKGIpO1xuICAgICAgICAgIGlmIChiMikge1xuICAgICAgICAgICAgYjIuaXRlbXMucHVzaChpdGVtKTtcbiAgICAgICAgICAgIGxldCBsZWZ0ID0gdGhpcy5wYWNrVG9CaW4oYjIsIGIyLml0ZW1zKTtcbiAgICAgICAgICAgIGlmIChsZWZ0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICBiID0gYjI7XG4gICAgICAgICAgICAgIGZpdHRlZCA9IHRydWU7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghZml0dGVkKSB7XG4gICAgICAgICAgdW5wYWNrZWQucHVzaChpdGVtKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB1bnBhY2tlZDtcbiAgfVxuXG4gIHBhY2soKSB7XG4gICAgLy8gU29ydCBiaW5zIHNtYWxsZXN0IHRvIGxhcmdlc3QuXG4gICAgdGhpcy5iaW5zLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIHJldHVybiBhLmdldFZvbHVtZSgpIC0gYi5nZXRWb2x1bWUoKTtcbiAgICB9KTtcblxuICAgIC8vIFNvcnQgaXRlbXMgbGFyZ2VzdCB0byBzbWFsbGVzdC5cbiAgICB0aGlzLml0ZW1zLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIHJldHVybiBiLmdldFZvbHVtZSgpIC0gYS5nZXRWb2x1bWUoKTtcbiAgICB9KTtcblxuICAgIHdoaWxlICh0aGlzLml0ZW1zLmxlbmd0aCA+IDApIHtcbiAgICAgIGxldCBiaW4gPSB0aGlzLmZpbmRGaXR0ZWRCaW4odGhpcy5pdGVtc1swXSk7XG5cbiAgICAgIGlmIChiaW4gPT09IG51bGwpIHtcbiAgICAgICAgdGhpcy51bmZpdEl0ZW0oKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaXRlbXMgPSB0aGlzLnBhY2tUb0JpbihiaW4sIHRoaXMuaXRlbXMpO1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9